"use strict";define(["angular","text!./ezFixedPanel.html","less!./ezFixedPanel"],function(a,b){var c=0;return a.module("ezweb.layout.fixedPanel",[]).directive("ezPanelsManager",["$parse",function(b){return{controller:[function(){this.panels={},this.registerPanel=function(b,d){var e=++c;this.panels[e]={stickySides:b,size:d};var f=a.bind(this,function(){delete this.panels[e]});return f.id=e,f}}],link:function(c,d,e,f){function g(b){var c,e,g;b.top===!0&&b.bottom!==!0?(c="height",e="top",g="bottom"):b.bottom===!0&&b.top!==!0?(c="height",e="bottom",g="top"):b.left===!0&&b.right!==!0?(c="width",e="left",g="right"):b.right===!0&&b.left!==!0&&(c="width",e="right",g="left");var h=0;a.forEach(f.panels,function(a){a.stickySides[e]===!0&&a.stickySides[g]!==!0&&(h+=a.size[c])}),d.css("padding-"+e,""+h+"px")}c.$on("ezweb.internal.fixed.panel.resized",function(a){a.stopPropagation(),g(a.targetScope.stickySides)});var h=b(e.ezPanelsManager);c.$watch(h,function(b){(a.isUndefined(b)||b)&&(g({top:!0}),g({bottom:!0}),g({left:!0}),g({right:!0}))})}}}]).directive("ezFixedPanel",["$interval","$window","$document","ezweb.core.services.cursor",function(c,d,e,f){function g(){var a="getSelection"in d?d.getSelection():"selection"in document?e[0].selection:null;"removeAllRanges"in a?a.removeAllRanges():"empty"in a&&a.empty()}function h(b,c,d,e){this.horizontalDirection=b,this.verticalDirection=c,this.$scope=d,this.findSize=e,this.originalSize=a.copy(this.$scope.size),this.originalCursorPosition={x:0,y:0}}return h.prototype={start:function(){this.originalCursorPosition=a.copy(f),this.originalSize=this.findSize();var b=c(a.bind(this,function(){g(),0!==this.horizontalDirection&&(this.$scope.size.width=this.originalSize.width+(f.x-this.originalCursorPosition.x)*this.horizontalDirection),0!==this.verticalDirection&&(this.$scope.size.height=this.originalSize.height+(f.y-this.originalCursorPosition.y)*this.verticalDirection),this.$scope.onResize({size:this.$scope.size}),this.$scope.$emit("ezweb.internal.fixed.panel.resized")}),1e3/12),d=!0,e=this.$scope.$parent.$watch("ezweb.cursor.pressed",function(a){a===!1&&(d===!0?d=!1:(e(),c.cancel(b)))})}},{transclude:!0,restrict:"E",require:["^?ezPanelsManager","?^ezResponsive"],scope:{sides:"@",resizeable:"&",onResize:"&",size:"=?",positions:"&"},template:b,link:function(b,c,d,e){var f=e[0],g=e[1];b.stickySides=a.isDefined(b.sides)?{top:b.sides.indexOf("top")>=0,bottom:b.sides.indexOf("bottom")>=0,left:b.sides.indexOf("left")>=0,right:b.sides.indexOf("right")>=0}:{top:!1,bottom:!1,left:!1,right:!1},b.orientations={vertical:b.stickySides.left!==b.stickySides.right,horizontal:b.stickySides.top!==b.stickySides.bottom},b.size=b.size||{width:null,height:null};var i=c.children(),j=function(){return{width:b.orientations.vertical===!0?i.width():null,height:b.orientations.horizontal===!0?i.height():null}};b.resize={nw:new h(-1,-1,b,j),n:new h(0,-1,b,j),ne:new h(1,-1,b,j),w:new h(-1,0,b,j),e:new h(1,0,b,j),sw:new h(-1,1,b,j),s:new h(0,1,b,j),se:new h(1,1,b,j)};var k=null;if(a.isDefined(f)&&b.$watch("fixed",function(a){if(a===!0){var c=j();b.size.width=b.size.width||c.width,b.size.height=b.size.height||c.height,k=f.registerPanel(b.stickySides,b.size)}else null!==k&&(k(),k=null);b.$emit("ezweb.internal.fixed.panel.resized")}),c.on("dragstart",function(){return!1}),c.on("selectstart",function(){return!1}),b.$on("$destroy",function(){null!==k&&k()}),b.fixed=!0,b.responsiveActive=!1,a.isDefined(d.ezResponsivePagePart)){if(a.isUndefined(g))throw"No idea why, but somehow we got there with a page part and no responsive.";var l={};a.forEach(g.affectedBreakpoints(),function(a){l[a]=!0}),b.$parent.$watch("ezweb.responsive.breakpoint",function(a){b.responsiveActive=l[a]})}var m={};b.fixedStyle=function(a){return b.fixed===!0?a:m},b.$watch("responsiveActive",function(a){b.fixed=!a})}}}])});