define(["angular","jquery"],function(a,b){"use strict";return a.module("ezweb.core.services.notifications",[]).factory("ezweb.core.services.notifications",["$rootScope","ezweb.core.services.scope",function(c,d){var e=[],f=0,g=0,h={id:null,title:"",text:"",importance:"info",action:null,read:!1,$read:function(){d.notifications.markRead(this.id)},$remove:function(){d.notifications.remove(this.id)}},i=null;return c.$on("ezweb.logout",function(){e=[],f=0,i=null}),d.ensure("notifications",{add:function(a){i=null,delete a.id;var d=b.extend({},h,a,{id:++g});return d.read===!1&&f++,e.unshift(d),c.$broadcast("ezweb.notifications.added",d,f),d},remove:function(b){i=null;var d=-1;if(a.forEach(e,function(a,c){a.id===b&&(d=c)}),d>=0){e[d].read===!1&&f--;var g=e[d];e.splice(d,1),c.$broadcast("ezweb.notifications.removed",g,f)}},markRead:function(b){i=null,a.forEach(e,function(a){a.id===b&&a.read===!1&&(a.read=!0,f--,c.$broadcast("ezweb.notifications.read",a,f))})},markAllRead:function(){a.forEach(e,function(a){a.read=!0,f--,c.$broadcast("ezweb.notifications.read",a,f)}),i=null},unread:function(){return f>0?f:void 0},all:function(){return null===i&&(i=a.copy(e)),i}}),d.notifications}])});