"use strict";define(["angular","text!../views/portal.html","text!../views/portalCube.html","../services/portalDataService","../services/portalRowService"],function(a,b,c){function d(a){this.templateKey=a}return d.prototype={restrict:"E",require:"^ezPortal",transclude:!0,scope:{centered:"@"},compile:function(){var b=this;return{pre:function(c,d,e,f,g){var h={centered:!0};a.extend(c,h),g(function(a){d.append(a),f.setCustomTemplate(b.templateKey,a)});var i=[];a.forEach(e,function(a,b){"class"===b&&i.push(a)}),f.setCustomTemplateClasses(b.templateKey,i)},post:function(){}}}},a.module("ezweb.portal.directives",[]).directive("ezPortal",["ezweb.portal.services.data","ezweb.portal.services.row","ezweb.core.services.responsive",function(a,c,d){var e={},f={};return{restrict:"E",transclude:!0,template:b,scope:{data:"=",item:"@?",cubeRatio:"@?",onCreate:"&?",onRemove:"&?",readOnly:"=?",rowSize:"=?",slots:"@?"},controller:["$scope",function(a){this.setCustomTemplate=function(a,b){e[a]=b},this.getCustomTemplate=function(a){return e[a]},this.setCustomTemplateClasses=function(a,b){f[a]=b},this.getCustomTemplateClasses=function(a){return f[a]},this.removeElement=function(b){a.onRemove({index:b})},this.addElement=function(b){a.onCreate({index:b})}}],link:function(b){function e(e){for(var f=0;f<e.size;f++)e[f].customIndex=f;b.config.slots&&(e=a.formatData(e,b.config.slots)),b.rows=c.getRows(e,b.config.rowSize[d.breakpoint])}b.config=a.getScopeConfig(b),b.$watchCollection("data",function(b){a.evaluateData(b,e)}),b.classes=a.classes(b.config.rowSize),b.$watch(function(){return d.breakpoint},function(){a.evaluateData(b.data,e)})}}}]).directive("ezPortalCube",["$compile",function(b){return{restrict:"E",require:"^ezPortal",template:c,scope:{model:"=",item:"@",index:"@",readOnly:"="},link:function(c,d,e,f){function g(a){j.append(a),b(j.children())(c)}function h(d,e,g){var h=a.element(e);a.forEach(f.getCustomTemplateClasses(g),function(a){d.addClass(a)}),d.empty(),d.append(h.clone()),b(d.children())(c)}function i(b){var c=a.isUndefined(f.getCustomTemplate(b))?l[b]:f.getCustomTemplate(b),e=d.find(".ez-portal-cube-"+b+":first");h(e,c,b)}var j=d.find(".ez-portal-cube-resolved:first");if(j.empty(),c[c.item]={$index:Number(c.index),$readonly:c.readOnly,$removeTemplate:function(a){f.removeElement(a?a:c.index)},$addTemplate:function(a){f.addElement(a?a:c.index)}},a.isDefined(c.model)&&!c.model.empty){c.model.$resolved=!1;var k=c.model.then(g);k["finally"](function(){c.model.$resolved=!0})}c.createElement=function(){c.readOnly||f.addElement(c.index)};var l={};l.empty="<span>This is empty!</span>",l.loading='<span ez-loading-indicator message="Loading..." show-when="!model.$resolved"></span>',i("empty"),i("loading")}}}]).directive("ezPortalElementEmpty",[function(){return new d("empty")}]).directive("ezPortalElementLoading",[function(){return new d("loading")}])});