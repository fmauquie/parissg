"use strict";define(["angular","./formDirective","ez-i18n!../locales","../vendor/bootstrap-datepicker/js/bootstrap-datepicker","../../core/services/scopeServices"],function(a,b,c){function d(b){return a.isDate(b)&&!isNaN(b.getTime())}function e(a){return d(a)?a:null}var f={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",format:"mm/dd/yyyy",weekStart:"0"},g={autoclose:"&",beforeShowDay:"&",calendarWeeks:"&",clearBtn:"&",daysOfWeekDisabled:"&",endDate:"&",format:"@",keyboardNavigation:"&",minViewMode:"@",multidate:"&",multidateSeparator:"@",orientation:"@",startDate:"&",startView:"@",todayBtn:"&",todayHighlight:"&",onShow:"&",onHide:"&"};return a.module("ezweb.form.directives.datepicker",["ezweb.core.services.scope","ezweb.i18n"]).config(["ezweb.i18n.configurationProvider",function(a){a.registerIfNotDefined("ezweb.form","en",c)}]).directive("ezFormDatepicker",["$i18next","$window","ezweb.core.services.scope",function(){function c(b){return a.isDefined(b.dateRange)?"date-range":a.isDefined(b.inline)||a.isDefined(b.embedded)?"embedded":"component"}var d={_parseExtendedAttributes:function(b,d){var e=[];this.options.datepicker={type:c(d)},a.forEach(d,function(b,c){a.isDefined(g[c])&&e.push(d.$attr[c]+'="'+b+'"')}),this.options.datepicker.args=e.join(" ")},_buildExtendedAttributesFormElement:function(){return this.options.ngAttributes+" "+this.options.datepicker.args},_buildBaseFormElement:function(){var a="<div ez-control-element ez-form-internal-datepicker ez-form-internal-datepicker-"+this.options.datepicker.type+" "+this._buildExtendedAttributesFormElement()+">";return a+="</div>"}},e=new b(d);return e}]).directive("ezFormInternalDatepicker",["$i18next","ezweb.core.services.scope",function(b,c){function e(b,c,d,e){var f={};return a.forEach(d,function(d){if(a.isFunction(b[d])&&a.isDefined(c[d])){var g=b[d].call();f[d]=a.isDefined(g)?g:e[d]}}),f}function h(b,c,d,e){a.forEach(e,function(e){a.isDefined(c[e])&&(d[e]=b[e])})}return{require:["ezFormInternalDatepicker","ngModel"],scope:g,controller:[function(){this.target=null,this.multidate=!1,this.init=function(a){this.target=a},this.show=function(){this.target.datepicker("show")},this.getDate=function(){return this.target.datepicker(this.multidate===!0?"getUTCDates":"getUTCDate")},this.getClearDate=function(){return this.multidate===!0?[]:void 0},this.setDate=function(b){if(null!==this.target)if(this.multidate===!0)if(a.isArray(b)){for(var c=[],d=0;d<b.length;d++)a.isNumber(b[d])?b[d]=new Date(b[d]):a.isDate(b[d])||c.push(d);for(;c.length>0;)b.splice(c.pop(),1);this.target.datepicker("setUTCDates",b)}else a.isDefined(b)&&null!==b&&""!==b?this.target.datepicker("setUTCDates",[b]):this.target.datepicker("setUTCDates",[]);else a.isDate(b)?this.target.datepicker("setUTCDate",b):a.isNumber(b)?this.target.datepicker("setUTCDate",new Date(b)):this.target.datepicker("setUTCDate")},this.defineEmpty=function(b){return a.bind(this,function(c){return this.multidate===!0?a.isArray(c)&&0===c.length:b(c)||!d(c)})}}],link:function(d,g,i,j){function k(){var b=l();$.fn.datepicker.dates[o]=b,m.target.datepicker("remove"),m.target.off(".ezFormDatepicker"),a.isString(b.format)&&b.format.length>0&&(m.target.datepicker(a.extend({},p,{language:o})),m.target.on("changeDate.ezFormDatepicker",function(){var a=m.getDate();d.$evalAsync(function(){q=null===a?void 0:a,n.$setViewValue(q)})}),m.target.on("clearDate.ezFormDatepicker",function(){d.$evalAsync(function(){q=m.getClearDate(),n.$setViewValue(q)})}),a.isDefined(i.onShow)&&m.target.on("show.ezFormDatepicker",function(){d.$evalAsync(function(){d.onShow()})}),m.target.on("hide.ezFormDatepicker",function(){d.$evalAsync(function(){a.isDefined(i.onHide)&&d.onHide(),n.ezwebForm.blurred=!0})}),m.target.on("$destroy.ezFormDatepicker",function(){m.target.off(".ezFormDatepicker")}),m.setDate(q))}function l(){var c={};return a.forEach(f,function(d,e){a.isArray(d)?(c[e]=[],a.forEach(d,function(a){c[e].push(b("ezweb.form:datepicker."+e+"."+a))})):c[e]=b("ezweb.form:datepicker."+e)}),c}var m=j[0],n=j[1],o=c.i18n.language,p=e(d,i,["autoclose","calendarWeeks","clearBtn","daysOfWeekDisabled","endDate","keyboardNavigation","minViewMode","multidate","startDate","todayBtn","todayHighlight"],{autoclose:!0,clearBtn:!0,keyboardNavigation:!0,multidate:!0,todayBtn:"linked",todayHighlight:!0});h(d,i,p,["format","multidateSeparator","orientation","startView"]),a.isDefined(i.beforeShowDay)&&(p.beforeShowDay=function(a){return d.beforeShowDay({date:a})}),d.$watch("daysOfWeekDisabled()",function(a){m.target.datepicker("setDaysOfWeekDisabled",a)},!0),d.$watch("endDate()",function(a){m.target.datepicker("setEndDate",a)}),d.$watch("startDate()",function(a){m.target.datepicker("setStartDate",a)}),a.isDefined(p.multidate)&&p.multidate!==!1&&(m.multidate=!0);var q=null;n.$render=function(){q=n.$modelValue,m.setDate(q)};var r=n.$isEmpty;n.$isEmpty=m.defineEmpty(r),d.$on("i18nextLanguageChange",function(b,c){a.isDefined(c)&&(o=c,k())}),k()}}}]).directive("ezFormInternalDatepickerComponent",[function(){return{priority:100,template:'<div class="input-group"><input type="text" class="form-control" ez-form-internal-datepicker-target /><span class="input-group-btn"><button class="btn btn-default" type="button"><i class="fa fa-calendar"></i></button></span></div>',require:"ezFormInternalDatepicker",link:function(a,b,c,d){b.find("button").on("click.ezFormInternalDatepickerComponent",function(){a.$apply(function(){d.show()})}),b.find("button").on("$destroy.ezFormInternalDatepickerComponent",function(){b.find("button").off(".ezFormInternalDatepickerComponent")})}}}]).directive("ezFormInternalDatepickerDateRange",[function(){return{priority:100,template:'<div class="input-group input-daterange" ez-form-internal-datepicker-target><span class="input-group-addon" ng-i18next="ezweb.form:daterange.from"></span><input type="text" class="form-control" /><span class="input-group-addon" ng-i18next="ezweb.form:daterange.to"></span><input type="text" class="form-control" /></div>',require:"ezFormInternalDatepicker",link:{pre:function(b,c,f,g){g.getDate=function(){if(this.multidate===!0)throw"multidate makes no sense with date-range !";var a=this.target.data("datepicker");return[e(a.dates[0]),e(a.dates[1])]},g.getClearDate=function(){if(this.multidate===!0)throw"multidate makes no sense with date-range !";return[null,null]},g.setDate=function(b){if(this.multidate===!0)throw"multidate makes no sense with date-range !";a.isArray(b)||(b=a.isNumber(b)?[new Date(b),null]:a.isDate(b)?[b,null]:[null,null]);var c=this.target.data("datepicker");a.isDefined(c)&&(a.forEach(b,function(b,d){a.isDate(b)?c.pickers[d].setUTCDate(b):a.isNumber(b)?c.pickers[d].setUTCDate(new Date(b)):c.pickers[d].setUTCDate()}),c.updateDates())},g.defineEmpty=function(b){return a.bind(this,function(c){if(this.multidate===!0)throw"multidate makes no sense with date-range !";return a.isArray(c)?2!==c.length?!0:b(c[0])||b(c[1])||!d(c[0])||!d(c[1]):!0})}}}}}]).directive("ezFormInternalDatepickerEmbedded",[function(){return{priority:100,template:"<div ez-form-internal-datepicker-target></div>"}}]).directive("ezFormInternalDatepickerTarget",[function(){return{require:"^ezFormInternalDatepicker",link:function(a,b,c,d){d.init(b)}}}])});