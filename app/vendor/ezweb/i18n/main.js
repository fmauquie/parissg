define(["angular","./vendor/ng-i18next","../core/services/scopeServices"],function(a){"use strict";return a.module("ezweb.i18n",["jm.i18next","ezweb.core.services.scope"]).provider("ezweb.i18n.configuration",[function(){var b,c={};this.namespaces=[],this.waiting=[],this.load=null;var d=this,e=function(e,f,g){if(a.isUndefined(c[e])&&(c[e]={},d.namespaces.push(e)),c[e].module=g,c[e][f]=g,a.isUndefined(b))if(a.isDefined(g.languageUrl))b="dev";else{if(!a.isDefined(g.moduleName))throw console.log(g),"Unknown config type for namespace "+e+" and language "+f+".";b="prod"}};this.registerIfNotDefined=function(b,d,f){a.isDefined(c[b])&&a.isDefined(c[b][d])||e(b,d,f)},this.register=function(b,d,f,g){if(a.isDefined(c[b])&&a.isDefined(c[b][d])&&g!==!0)throw"Resource for namespace "+b+" and language "+d+" is already defined with URL "+c[b][d]+". Can't redefine it with URL "+f+".";e(b,d,f)},this.$get=["$window","$rootScope","$i18next","$log","ezweb.core.services.scope",function(e,f,g,h,i){return f.$on("i18nextLanguageChange",function(a,b){i.ensure("i18n",{language:b}),f.$broadcast("ezweb.i18n.language",b)}),{mode:b,init:function(f,g){d.load=function(d,i,j,k){if(!a.isDefined(c[i]))throw k("err"),"Namespace "+i+" has never been defined.";var l,m;if(a.isDefined(c[i][d]))m=d;else{if(!a.isDefined(c[i].module))throw k("err"),h.error(c[i]),'Error, this is a bug ! "module" at least should be defined in namespace '+i+".";m="module"}if("dev"===b&&a.isDefined(c[i][d])?l=c[i][d].languageUrl(d):"prod"===b&&a.isDefined(f[d])&&(l=g+f[d]),a.isDefined(l))e.require(["text!"+l],function(b){var d=a.fromJson(b);if(a.isDefined(d[c[i][m].moduleName])){var e=d[c[i][m].moduleName];k(null,e)}else k(null,d)},function(a){k("Error while loading resource: ",a.requireType)});else{var n="No translations found for namespace "+i+" and language "+d+".";k(n)}},a.forEach(d.waiting,function(a){d.load.apply(null,a)})},error:function(){d.load=function(a,b,c,d){d("error :(")}},languageChanged:function(a){h.warn("ezweb.i18n.configuration.languageChanged() is deprecated. Change $i18next.options.lng instead."),g.options.lng=a}}}]}]).config(["$i18nextProvider","ezweb.i18n.configurationProvider",function(b,c){a.extend(b.options,{useCookie:!1,useLocalStorage:!1,fallbackLng:"en",defaultLoadingValue:"",defaultValue:"",ns:{namespaces:c.namespaces,defaultNs:"home"},lowerCaseLng:!0,customLoad:function(){null===c.load?c.waiting.push(arguments):c.load.apply(null,arguments)}})}]).run(["$window","ezweb.i18n.configuration","ezweb.core.services.scope",function(b,c,d){var e=b.i18n.lng();if(d.ensure("i18n",{language:e}),"prod"===c.mode){var f=b.require.s.contexts._.config.localesPrefix||"locales/";f.lastIndexOf("/")!==f.length-1&&(f+="/"),b.require(["text!"+f+"locales.json"],function(b){var d=a.fromJson(b);c.init(d,f)},function(){c.error()})}else c.init()}])});