define(["angular","./i18next"],function(a){a.module("jm.i18next",["ng"]),a.module("jm.i18next").provider("$i18next",function(){"use strict";var b=this,c=null,d={},e=null,f=null,g=0;b.options={},b.$get=["$rootScope","$timeout",function(h,i){function j(a){if(window.i18n)window.i18n.init(a,function(a){d={},c=a,h.$$phase||h.$digest(),h.$broadcast("i18nextLanguageChange",window.i18n.lng())});else{if(g++,!(5>g))throw new Error("[ng-i18next] Can't find i18next!");i(function(){j(a)},400)}}function k(b,c){m.debugMsg.push(["i18next options changed:",c,b]),e=b,f=a.copy(e),delete f.lng,j(e)}function l(a,b,f){var g=b.lng||"auto";d[g]||(d[g]={}),c?(!d[g][a]||f)&&(d[g][a]=c(a,b)):d[g][a]="defaultLoadingValue"in b?b.defaultLoadingValue:"defaultValue"in b?b.defaultValue:"defaultLoadingValue"in e?e.defaultLoadingValue:a}function m(b,c){var e=c?a.extend({},f,c):f;return l(b,e,!!c),e.lng?d[e.lng][b]:d.auto[b]}return m.debugMsg=[],m.options=b.options,b.options!==e&&k(b.options,e),m.reInit=function(){k(e,e)},h.$watch(function(){return m.options},function(a,b){a&&b!==a&&k(a,b)},!0),m}]}),a.module("jm.i18next").directive("ngI18next",["$i18next","$compile","$parse","$interpolate",function(a,b,c,d){"use strict";function e(a){var b={attr:"text"};a=a.split(":");for(var c=0;c<a.length;++c)"i18next"===a[c]?b[a[c]]=!0:b.attr=a[c];return b}function f(a){var b,d={attr:"text"},f="{}";return a=a.trim(),0===a.indexOf("[")&&(b=a.split("]"),d=e(b.shift().substr(1).trim()),a=b.join("]")),d.i18next&&0===a.indexOf("(")&&a.indexOf(")")>=0&&(b=a.split(")"),a=b.pop().trim(),f=b.join(")").substr(1).trim()),{key:a,options:d,i18nOptions:c(f)}}function g(c,e){function g(g){function j(f){f.sprintf&&(f.postProcess="sprintf");var g=a(k.key,f);if("html"===k.options.attr)return e.empty().append(g),void b(e.contents())(c);i&&i();var h=e.text.bind(e);"text"!==k.options.attr&&(h=e.attr.bind(e,k.options.attr)),g=d(g),i=c.$watch(g,h),h(g(c))}var k=f(g);h&&h(),i&&i(),h=c.$watch(k.i18nOptions,j,!0),j(k.i18nOptions(c))}var h,i;this.localize=function(a){for(var b=a.split(";"),c=0;c<b.length;++c)a=b[c].trim(),""!==a&&g(a)}}return{restrict:"A",scope:!1,controller:["$scope","$element",g],require:"ngI18next",link:function(a,b,c,e){function f(a){return h=a.replace(/^\s+|\s+$/g,""),""===h?g():void e.localize(h)}function g(){if(!g.done){var c=d(b.html());a.$watch(c,f),g.done=!0}}var h="";c.$observe("ngI18next",f),a.$on("i18nextLanguageChange",function(){e.localize(h)})}}}]),a.module("jm.i18next").filter("i18next",["$i18next",function(a){"use strict";return function(b,c){return a(b,c)}}])});