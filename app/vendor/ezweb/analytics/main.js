"use strict";define(["angular","jquery","./vendor/angulartics/angulartics","./vendor/angulartics/angulartics-piwik"],function(a){return a.module("ezweb.analytics",["angulartics","angulartics.piwik"]).factory("ezweb.analytics.service",["$window","$document","$q","$log",function(a,b,c,d){function e(){if("stopped"!==f)throw"Analytics have already been started or suppressed. Status is: "+f}a._paq=a._paq||[];var f="stopped",g=c.defer();return{start:function(c,d){e(),f="starting",a._paq.push(["enableLinkTracking"]),a._paq.push(["setTrackerUrl",c+"/piwik.php"]),a._paq.push(["setSiteId",d]);var h=b[0],i=h.createElement("script");i.type="text/javascript",i.defer=!0,i.async=!0,i.src=c+"/piwik.js",i.onload=function(){f="started",g.resolve(f)},i.onerror=function(){f="error",g.reject()},i.onreadystatechange=function(){"loaded"===i.readyState?(f="error",g.reject(),i.onreadystatechange=null,i.load=null,i.error=null):"complete"===i.readyState&&(f="started",g.resolve(f),i.onreadystatechange=null,i.load=null,i.error=null)};var j=h.getElementsByTagName("script")[0];return j.parentNode.insertBefore(i,j),g.promise},suppress:function(){return e(),a._paq={push:function(){}},f="suppressed",g.resolve(f),g.promise},log:function(){return e(),a._paq={push:function(a){d.info("Analytics event: "+JSON.stringify(a))}},f="logging",g.resolve(f),g.promise},promise:function(){return g.promise},check:function(){return"stopped"!==f}}}]).run(["$timeout","$log","ezweb.analytics.service",function(a,b,c){function d(){c.check()||b.warn("ezweb.analytics has been loaded but has not been initialized. if this is normal to load it but not start it (i.e. dev mode), you should initialize it properly with start(), or suppress it with suppress() ")}var e=a(d,3e4);c.promise().then(function(){a.cancel(e)},function(){a.cancel(e),b.error("ezweb.analytics configuration is bad. The analytics could not start.")})}])});