"use strict";
define(["angular", "jquery", "text!../views/login.html","ez-i18n!../locales","less!../styles/login","../services/usersServices"],function(a,b,c,d){function e(a){return a.ezweb?a:e(a.$parent)}function f(a,b,c,d){var e;return function(f){a(f)===!0?e||d(b,function(a){e={clone:a},c.after(a)}):e&&(e.clone.remove(),e=null)}}return a.module("ezweb.auth.directives",["ezweb.auth.services","ezweb.i18n"]).config(["ezweb.i18n.configurationProvider",function(a){a.registerIfNotDefined("ezweb.auth","en",d)}]).directive("ezUserRequireLoggedIn",["ezweb.auth.services.users",function(){return{restrict:"A",transclude:"element",priority:1e4,terminal:!0,scope:!1,link:function(a,b,c,d,g){e(a).$watch("ezweb.user.connected",f(function(a){return a},a,b,g))}}}]).directive("ezUserRequireLoggedOut",["ezweb.auth.services.users",function(){return{restrict:"A",transclude:"element",priority:1e4,terminal:!0,scope:!1,link:function(a,b,c,d,g){e(a).$watch("ezweb.user.connected",f(function(a){return!a},a,b,g))}}}]).directive("ezUserHasRole",["ezweb.auth.services.users",function(){return{restrict:"A",transclude:"element",priority:1e4,terminal:!0,scope:!1,link:function(a,c,d,g,h){var i=d.ezUserHasRole;e(a).$watch("ezweb.user.roles",f(function(a){return b.inArray(i,a)>=0},a,c,h))}}}]).directive("ezLoginPage",["ezweb.auth.services.users","ezweb.core.services.scope",function(a,b){return{restrict:"A",scope:{usernameIsEmail:"&",stubLogin:"=",sesame:"&"},replace:!0,template:c,controller:["$scope",function(c){c.info={username:"",password:"",rememberme:!1},c.supportRememberMe=b.backends.users.hasRememberMe,c.$watch(function(){return b.backends.users.hasRememberMe},function(a){c.supportRememberMe=a}),c.login=function(){delete c.error;var b=c.stubLogin?c.stubLogin:a.login;b(c.info.username,c.info.password,c.info.rememberme).then(function(){delete c.info},function(a){c.error=a})}}]}}])});